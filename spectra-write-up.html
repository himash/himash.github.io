<!DOCTYPE html>
<html lang="en"> 
<head>



<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-5YK5MXEZF1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-5YK5MXEZF1');
</script>


    <title>Write-ups</title>
    
    <!-- Meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
       
    <link rel="shortcut icon" href="favicon.ico"> 
    
    <!-- FontAwesome JS-->
    <script defer src="https://use.fontawesome.com/releases/v5.7.1/js/all.js" integrity="sha384-eVEQC9zshBn0rFj4+TU78eNA19HMNigMviK/PU/FFjLXqa/GKPgX58rvt5Z8PLs7" crossorigin="anonymous"></script>
    
    <!-- Theme CSS -->  
    <link id="theme-style" rel="stylesheet" href="assets/css/theme-1.css">
    

</head> 

<body>
    
    <header class="header text-center">	    
	    <h1 class="blog-name pt-lg-1 mb-0"><a href="index.html">Adventures with Bits  </a></h1>
        
	    <nav class="navbar navbar-expand-lg navbar-dark" >
           
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation" aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
			</button>

			<div id="navigation" class="collapse navbar-collapse flex-column" >
				<div class="profile-section pt-3 pt-lg-0">
				    <img class="profile-image mb-3 rounded mx-auto" src="assets/images/profile.png" alt="image" >			
					
					<div class="bio mb-3">"Technical Problems Can Have Artistic Solutions"<br>
                                 - Jon Erickson The Art of Exploitation </div><!--//bio-->
					<ul class="social-list list-inline py-3 mx-auto">

			            <li class="list-inline-item"><a href="https://twitter.com/UnknownHimash"><i class="fab fa-twitter fa-fw"></i></a></li>
			           
			            <li class="list-inline-item"><a href="https://github.com/himash"><i class="fab fa-github-alt fa-fw"></i></a></li>
			            
			        </ul><!--//social-list-->
			        
				</div><!--//profile-section-->
				
				<ul class="navbar-nav flex-column text-left">
					<li class="nav-item">
					    <a class="nav-link" href="index.html"><i class="fas fa-home fa-fw mr-2"></i>Blog Home <span class="sr-only">(current)</span></a>
					</li>

           <li class="nav-item">
					    <a class="nav-link" href="exploits.html"><i class="fas fa-user fa-fw mr-2"></i>Exploits & Vulnerabilities</a>
					</li> 



					<li class="nav-item">
					    <a class="nav-link" href="publications.html"><i class="fas fa-bookmark fa-fw mr-2"></i>Publications</a>
					</li>

						<li class="nav-item">
					    <a class="nav-link" href="projects.html"><i class="fas fa-bookmark fa-fw mr-2"></i>Projects</a>
					</li>
					<li class="nav-item active">
					    <a class="nav-link" href="write-up.html"><i class="fas fa-user fa-fw mr-2"></i>Write-ups</a>
					</li>

					<li class="nav-item">
					    <a class="nav-link" href="tools.html"><i class="fas fa-user fa-fw mr-2"></i>Tools</a>
					</li>

					<li class="nav-item active">
					    <a class="nav-link" href="ack.html"><i class="fas fa-user fa-fw mr-2"></i>Acknowledgements</a>
					</li>

				</ul>
				
				
			</div>
		</nav>
    </header>


    <!-----------------------------------Header and stuff Ends Here-------------------------------------------------->





    <!-------------------------------------Article Starts Here --------------------------------------------------------------->
    
    <div class="main-wrapper">
	    
	    <article class="blog-post px-3 py-5 p-md-5">
		    <div class="container">
			    <header class="blog-post-header">
				    <h2 class="title mb-2">Spectra - HTB</h2>
				    

			    </header>
			    
			    <div class="blog-post-body">

			    	<!-----PICTURE
				    <figure class="blog-banner">
				        <a href="https://made4dev.com"><img class="img-fluid" src="assets/images/blog/blog-post-banner.jpg" alt="image"></a>

				        
				        <figcaption class="mt-2 text-center image-caption">Image Credit: <a href="https://made4dev.com?ref=devblog" target="_blank">made4dev.com (Premium Programming T-shirts)</a></figcaption>
				    </figure>
				    -------------------------------------------------------->

				    <p>

				    	<br>

				    	<figure class="blog-banner">

				        <a><img class="img-fluid" src="assets/images/writeup/spectra/sp-intro.png" alt="image"></a>

				      </figure>

				      <br>

				      This is easy machine with much more things to learn specially the instincts and methodology.
				      I will explain the methods and instincts that you can develop when doing this machine.
				      lets start with nmap scan, since it's a easy machine, for initial information gathering just start with simple scan.

				      <br><br>

				      <h4 class="title mb-2">Initial Foothold</h4>

				    	<figure class="blog-banner">

				        <a><img class="img-fluid" src="assets/images/writeup/spectra/sp-nmap1.png" alt="image"></a>

				      </figure>

				      <br>

				   

				    	<figure class="blog-banner">

				        <a><img class="img-fluid" src="assets/images/writeup/spectra/sp-nmap2.png" alt="image"></a>

				      </figure>

				      <br>
               
               from the initial scan, ports 22,80,3306 and 8081 are opened. open ports are default ports for the services SSH,HTTP,MySQL and port 8081 based on 'Service Name and Transport Protocol Port Number Registry' used by Sun Proxy Admin Service. (Refer : <a href=Refer:https://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.xhtml?search=80&page=4> https://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.xhtml?search=80&page=4 </a> ), from this result any of the above port will be our initial target to get foothold or user however since this is a CTF i would like to start with ports 80 and 8081. checking port 8081 i found 'hello world' message only. before digging deep i just went to check port 80.


				      <br><br>
              <figure class="blog-banner">

				        <a><img class="img-fluid" src="assets/images/writeup/spectra/sp-port8081.png" alt="image"></a>

				      </figure>
				      <br>

				      <br>
              <figure class="blog-banner">

				        <a><img class="img-fluid" src="assets/images/writeup/spectra/sp-port80.png" alt="image"></a>

				      </figure>
				      <br>

				      port 80 presented with issue tracking page, which says 'Until IT set up the Jira we can configure and use this for issue tracking' so basically from this message i can assume that this service is used as issue tracker before configuring Jira.
				      by checking 'Software Issue Tracker' i found wordpress site and checking 'test' i found error message says 'Error establishing a database connection'. to initially check a wordpress site i would use 'wpscan'. while running wpscan i just enumerated the 'http://spectra.htb/testing/index.php', by first attempt i found directory listing under 'http://spectra.htb/testing/'.

				      <br><br>
              <figure class="blog-banner">

				        <a><img class="img-fluid" src="assets/images/writeup/spectra/sp-dir.png" alt="image"></a>

				      </figure>
				      <br>  

				      if it is a wordpress site i will look for wp-config file to check if there is any credentials are there. i found credentials under wp-config.php.save file but contents are commented out to prevent viewing however we can see that by viewing the source code from browser. i found database credentials there. so i tried to connect to the database. but connection is refused. the error is because of the mysql default configuration allows connections only from the ‘root’ user when coming from ‘localhost’ and not other IP address ranges. when doing CTFs or even in real word penetration testing and red teaming assessments exposed credentials of any services are more valuable even if service is restricted, the main reason is most of the administrators use same credentials for the multiple services. moving on to the next step, up to now i have credentials of mysql only.
				      so i just went to wp-login page to give a try with database credentials. username devtest and password devteam01 is not worked, username administrator and password devteam01 worked and logged in to the admin panel. i got logged in 2nd attempt, but for this kind of attempt try-out with default credentials and try with all combinations of exposed credentials.        

              <br><br>
              <figure class="blog-banner">

				        <a><img class="img-fluid" src="assets/images/writeup/spectra/sp-admin-panel.png" alt="image"></a>

				      </figure>
				      <br> 

				      when you are doing testing on wordpress site after getting into the administrator panel you can easily get remote code execution by uploading a shell packaged as a plugin. it should work on all versions of WordPress because this is authenticated code execution by design. fire up the metasploit and use 'exploit/unix/webapp/wp_admin_shell_upload' to get remote connection to the machine. after successful exploitation i received the remote connection to the machine. to get user i have to find user credentials of katie or to use any other exploits. for the post exploitation part before using any scripts first just roam around the file system, most of the time even in real word penetration testing you will find the credentials from log and configuration files.  

				       <br><br>
              <figure class="blog-banner">

				        <a><img class="img-fluid" src="assets/images/writeup/spectra/sp-shell2.png" alt="image"></a>

				      </figure>
				      <br>  

				       <br>
              <figure class="blog-banner">

				        <a><img class="img-fluid" src="assets/images/writeup/spectra/sp-shell.png" alt="image"></a>

				      </figure>
				      <br> 

				      <h4 class="title mb-2">User</h4>

				      when enumerating around file system usually check for directories where you gained the initial foothold, html folder, var, opt and etc which may contain potential files to move further on the machine. after some enumeration i found this file something interesting under /opt 'autologin.conf.orig'

				      <pre>
				      <code>
# Copyright 2016 The Chromium OS Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.
description   "Automatic login at boot"
author        "chromium-os-dev@chromium.org"
# After boot-complete starts, the login prompt is visible and is accepting
# input.
start on started boot-complete
script
  passwd=
  # Read password from file. The file may optionally end with a newline.
  for dir in /mnt/stateful_partition/etc/autologin /etc/autologin; do
    if [ -e "${dir}/passwd" ]; then
      passwd="$(cat "${dir}/passwd")"
      break
    fi
  done
  if [ -z "${passwd}" ]; then
    exit 0
  fi
  # Inject keys into the login prompt.
  #
  # For this to work, you must have already created an account on the device.
  # Otherwise, no login prompt appears at boot and the injected keys do the
  # wrong thing.
  /usr/local/sbin/inject-keys.py -s "${passwd}" -k enter
end 


</code>
</pre> 

          This file is used to configure auto login at boot. (Refer: <a href=https://chromium.googlesource.com/chromiumos/overlays/chromiumos-overlay/+/master/chromeos-base/autologin/files/init/autologin.conf> https://chromium.googlesource.com/chromiumos/overlays/chromiumos-overlay/+/master/chromeos-base/autologin/files/init/autologin.conf </a>) by analyzing the file the password is loaded from the /etc/autologin directory. 

          <br><br>
            <figure class="blog-banner">

				        <a><img class="img-fluid" src="assets/images/writeup/spectra/sp-passwd.png" alt="image"></a>

				    </figure>
				   <br>

				   using the credentials log in to the system via SSH and i got the user.txt.
           
            <br><br>
            <figure class="blog-banner">

				        <a><img class="img-fluid" src="assets/images/writeup/spectra/sp-katie.png" alt="image"></a>

				    </figure>
				   <br>

				    <h4 class="title mb-2">Privilege Escalation</h4>

				   Next part is to find a way to escalate privileges to gain root in the machine. run sudo -l to see list the of allowed (and forbidden) commands for the invoking user katie. i found '/sbin/initctl' can be run with sudo. init(system initialisation) is the parent of all processes on the system, it is executed by the kernel and is responsible for starting all other processes; initctl allows a system administrator to communicate and interact with the Upstart init daemon. Processes managed by init are known as jobs and are defined by files in the /etc/init directory. [Refer: <a href=https://linux.die.net/man/8/init> https://linux.die.net/man/8/init </a>] so in simple words init is the parent of all processes; initctl allows to interact with init. /etc/init directory contains 'Jobs' in .conf files. i don't want to mess with system processes, so i just looked at test.conf file. test.conf is test node.js server configured by katie user. so there is a way to get root ! 
				   i replaced the test.conf with 'chmod +s /bin/bash' to change bash with setuid permission.

				   <pre>
				   <code>

description "Test node.js server"
author      "katie"

start on filesystem or runlevel [2345]
stop on shutdown

script

    chmod +s /bin/bash

end script

</code>
</pre>
          
          Then i run 'sudo /sbin/initctl start test' to start the test and bash -p, '-p' will allow the setuid bit to be effective in allowing bash to retain the user it is setuid to. finally i got the root.txt. 


          <br><br>
            <figure class="blog-banner">

				        <a><img class="img-fluid" src="assets/images/writeup/spectra/sp-root.png" alt="image"></a>

				    </figure>
				   <br>







				    	
                     



				    </p>

				    <!--------------------------------------------Article End ------------------------------------------------------>



				    <!--------------------------------------------------------------------------------------------- Coding section
				    <h3 class="mt-5 mb-3">Code Block Example</h3>
				    <p>You can get more info at <a href="https://highlightjs.org/" target="_blank">https://highlightjs.org/</a>. Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis, ultricies nec, pellentesque eu, pretium quis, sem. Nulla consequat massa quis enim. Donec pede justo, fringilla vel, aliquet nec, vulputate eget, arcu. In enim justo, rhoncus ut, imperdiet a, venenatis vitae, justo. Nullam dictum felis eu pede mollis pretium. Integer tincidunt. Cras dapibus. Vivamus elementum semper nisi. Aenean vulputate eleifend tellus. Aenean leo ligula, porttitor eu, consequat vitae, eleifend ac, enim. </p>
				    <pre>
					    <code>
function $initHighlight(block, cls) {
  try {
    if (cls.search(/\bno\-highlight\b/) != -1)
      return process(block, true, 0x0F) +
             ` class="${cls}"`;
  } catch (e) {
    /* handle exception */
  }
  for (var i = 0 / 2; i < classes.length; i++) {
    if (checkCondition(classes[i]) === undefined)
      console.log('undefined');
  }
}

export  $initHighlight;
					    </code>
				    </pre>

				  Ending here --------------------------------------------------------------------------------------------> 

					

					
				   
			    </div>
				    

				  <!--------------------------------------------------------------------------------- Navigation section  
			    <nav class="blog-nav nav nav-justified my-5">
				  <a class="nav-link-prev nav-item nav-link rounded-left" href="index.html">Previous<i class="arrow-prev fas fa-long-arrow-alt-left"></i></a>
				  <a class="nav-link-next nav-item nav-link rounded-right" href="blog-list.html">Next<i class="arrow-next fas fa-long-arrow-alt-right"></i></a>
				</nav>
				-----------------------------------------------------------------------------------------------------------> 

	    </article>
	    

    
    </div><!--//main-wrapper-->
    



    
       
    <!-- Javascript -->          
    <script src="assets/plugins/jquery-3.3.1.min.js"></script>
    <script src="assets/plugins/popper.min.js"></script> 
    <script src="assets/plugins/bootstrap/js/bootstrap.min.js"></script> 
    
    <!-- Page Specific JS -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/highlight.min.js"></script>

    <!-- Custom JS -->
    <script src="assets/js/blog.js"></script>
      
    

</body>
</html> 

